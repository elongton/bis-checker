<div class="container">
  <div style="display: flex; justify-content: space-between;">

    <div class="filter mb-4">
      <label for="classFilter">Filter by Class:</label>
      <select style="margin-left: 8px;" id="classFilter" [(ngModel)]="classFilter" (change)="updateQueryParams()">
        <option value="">All Classes</option>
        <option *ngFor="let cls of filteredClasses" [value]="cls">{{ cls }}</option>
      </select>

      <label style="margin-left: 10px;" for="nameSearch">Search by Name:</label>
      <input style="margin-left: 8px;" id="nameSearch" [(ngModel)]="nameSearch" (input)="updateQueryParams()" />

      <label style="margin-left: 10px;" for="corePlayers">Core Raiders Only:</label>
      <input style="margin-left: 8px;" type="checkbox" id="corePlayers" [(ngModel)]="corePlayers"
        (change)="updateQueryParams()" />
    </div>

    <div style="display: flex; align-items: center;">
      <button appButton *ngIf="!editMode && ($user | async)" (click)="tryToggleEdit()" title="Edit">✏️ Edit</button>
      <button title="Select rows, then click this to paste parse info into Discord" appButton margin="0 0 0 10px" (click)="copyParseToClipboard()">
        {{ copiedParse ? 'Copied!!!' : 'Copy Parse' }}
      </button>
      <button title="Select rows, then click this to paste gear info into Discord" appButton margin="0 0 0 10px" (click)="copyTableToClipboard()">
        {{ copied ? 'Copied!!!' : 'Copy Gear' }}
      </button>
    </div>

  </div>

  <table class="table" style="table-layout: fixed; width: 100%; margin-top: 16px;">
    <thead>
      <tr style="text-align: left;">
        <th style="width: 25px;">
          <input type="checkbox" [checked]="areAllFilteredSelected()"
            (change)="toggleSelectAll($event.target.checked)" />
        </th>
        <th style="width: 14%" (click)="setSort('name')">
          Name
          <span *ngIf="sortColumn === 'name'">
            {{ sortDirection === 'asc' ? '↑' : '↓' }}
          </span>
        </th>
        <th style="width: 14%" (click)="setSort('class')">
          Class
          <span *ngIf="sortColumn === 'class'">
            {{ sortDirection === 'asc' ? '↑' : '↓' }}
          </span>
        </th>
        <th>
          Spec
        </th>
        <th (click)="setSort('softBis')">
          Soft BiS
          <span *ngIf="sortColumn === 'softBis'">
            {{ sortDirection === 'asc' ? '↑' : '↓' }}
          </span>
        </th>
        <th (click)="setSort('hardBis')">
          Hard BiS
          <span *ngIf="sortColumn === 'hardBis'">
            {{ sortDirection === 'asc' ? '↑' : '↓' }}
          </span>
        </th>
        <th (click)="setSort('attendance')">
          Attendance
          <span *ngIf="sortColumn === 'attendance'">
            {{ sortDirection === 'asc' ? '↑' : '↓' }}
          </span>
        </th>
        <th style="cursor: help" (click)="setSort('parse')" title="Latest Highest Parse - from most recent logged raid">
          Parse ⓘ
          <span *ngIf="sortColumn === 'parse'">
            {{ sortDirection === 'asc' ? '↑' : '↓' }}
          </span>
        </th>
        <th style="cursor: help" (click)="setSort('iparse')" title="Latest Highest iParse - based on similarly geared players">
          iParse ⓘ
          <span *ngIf="sortColumn === 'iparse'">
            {{ sortDirection === 'asc' ? '↑' : '↓' }}
          </span>
        </th>
        <th (click)="setSort('coreRaider')" style="text-align: center;">Core Raider
          <span *ngIf="sortColumn === 'coreRaider'">
            {{ sortDirection === 'asc' ? '↑' : '↓' }}
          </span>
        </th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let player of filteredPlayers">
        <td style="width: 25px;"><input type="checkbox" [checked]="isSelected(player.name)"
            (change)="toggleSelection(player.name)" /></td>
        <td><a style="text-decoration: none;" [routerLink]="['/players', player.name]">{{ player.name }}</a>
        </td>
        <td>{{ player.class }}</td>
        <td>
          <select *ngIf="editMode && ($user | async) as user" [(ngModel)]="player.spec"
            (ngModelChange)="updateSpec(player, $event)">
            <option [value]="spec"></option>
            <option *ngFor="let spec of getSpecOptionsForPlayer(player)" [value]="spec">{{ spec }}</option>
          </select>
          <a [routerLink]="['/bis-list', player.class, player.spec]" *ngIf="!( $user | async ) || !editMode">{{ player.spec == "undefined" ? null : player.spec }}</a>
        </td>
        <td>{{ getSoftBisCount(player) }}</td>
        <td>{{ getHardBisCount(player) }}</td>
        <td>{{ player.attendance.rate | number: '1.0-0'}}</td>
        <td appParseColor [title]="getLatestParseTitle(player, 'Parse')" style="cursor: help">{{player.latestPerformance
          ? player.latestPerformance.bestParse.parse : null}}</td>
        <td appParseColor [title]="getLatestParseTitle(player, 'iParse')" style="cursor: help">
          {{player.latestPerformance ? player.latestPerformance.bestIParse.iparse : null}}</td>
        <td style="text-align: center;">
          <span>{{ player.rank <=3 ? '✔' : 'No' }}</span>
        </td>
      </tr>
    </tbody>
  </table>
</div>